<!DOCTYPE html>
<html lang="en" class="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NoteFlow - Daily Notes & Summaries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .dark ::-webkit-scrollbar-track {
            background: #2d3748;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #555;
        }

        /* Note card animations */
        .note-card {
            animation: fadeIn 0.5s ease-out forwards;
        }

        .note-card-exit {
            animation: fadeOut 0.4s ease-out forwards;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: scale(1);
            }

            to {
                opacity: 0;
                transform: scale(0.9);
            }
        }

        /* Custom focus ring */
        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.5);
        }

        .dark .form-input:focus,
        .dark .form-textarea:focus,
        .dark .form-select:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.6);
        }

        /* Fixed height and text truncation */
        .note-description-truncate {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
            height: 6rem;
        }

        /* Modal & Toast animations */
        .modal,
        .toast-container {
            animation: fadeInBg 0.3s ease-out forwards;
        }

        .modal-content,
        .toast {
            animation: zoomInModal 0.3s ease-out forwards;
        }

        .toast-exit {
            animation: fadeOutToast 0.4s ease-out forwards;
        }

        @keyframes fadeInBg {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes zoomInModal {
            from {
                transform: scale(0.95);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeOutToast {
            from {
                opacity: 1;
                transform: translateY(0);
            }

            to {
                opacity: 0;
                transform: translateY(-20px);
            }
        }
    </style>
    <script>
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>

<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <!-- Header -->
        <header class="flex flex-wrap justify-between items-center mb-8 gap-4">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 dark:text-white">NoteFlow</h1>
            <div class="flex items-center gap-2">
                <button id="import-btn" aria-label="Import notes"
                    class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"><svg
                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="7 10 12 15 17 10" />
                        <line x1="12" y1="15" x2="12" y2="3" />
                    </svg></button>
                <input type="file" id="import-file" class="hidden" accept=".json">
                <button id="export-btn" aria-label="Export notes"
                    class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"><svg
                        xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" y1="3" x2="12" y2="15" />
                    </svg></button>
                <button id="theme-toggle" aria-label="Toggle theme"
                    class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <svg id="theme-toggle-light-icon" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <svg id="theme-toggle-dark-icon" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>
            </div>
        </header>

        <main>
            <!-- Note Input Form -->
            <div class="bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md mb-8">
                <form id="note-form" class="space-y-4">
                    <input type="hidden" id="note-id">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="md:col-span-2">
                            <label for="note-title"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Title</label>
                            <input type="text" id="note-title"
                                class="form-input w-full bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg p-3 transition"
                                placeholder="e.g., Chapter 5 Summary" required>
                        </div>
                        <div>
                            <label for="note-date"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Date</label>
                            <input type="date" id="note-date"
                                class="form-input w-full bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg p-3 transition"
                                required>
                        </div>
                    </div>
                    <div>
                        <label for="note-tags"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Tags
                            (comma-separated)</label>
                        <input type="text" id="note-tags"
                            class="form-input w-full bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg p-3 transition"
                            placeholder="e.g., work, study, personal">
                    </div>
                    <div>
                        <label for="note-description"
                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Description /
                            Notes</label>
                        <textarea id="note-description" rows="4"
                            class="form-textarea w-full bg-gray-100 dark:bg-gray-700 border-transparent rounded-lg p-3 transition"
                            placeholder="Write your detailed notes here..." required></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancel-edit-btn"
                            class="hidden px-5 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600 transition-all">Cancel</button>
                        <button type="submit" id="save-btn"
                            class="px-5 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:bg-blue-500 dark:hover:bg-blue-600 dark:focus:ring-blue-800 transition-all">Save
                            Note</button>
                    </div>
                </form>
            </div>

            <!-- Filters and Sorting -->
            <div class="flex flex-wrap gap-4 justify-between items-center mb-6">
                <input type="text" id="search-bar"
                    class="form-input w-full md:w-1/3 bg-white dark:bg-gray-800 border-transparent rounded-lg p-3 shadow-sm transition"
                    placeholder="🔍 Search by title...">
                <div id="tag-filter-container" class="flex flex-wrap gap-2"></div>
                <select id="sort-by"
                    class="form-select bg-white dark:bg-gray-800 border-transparent rounded-lg p-3 shadow-sm transition">
                    <option value="date-desc">Date (Newest First)</option>
                    <option value="date-asc">Date (Oldest First)</option>
                    <option value="title-asc">Title (A-Z)</option>
                    <option value="title-desc">Title (Z-A)</option>
                    <option value="edited-desc">Last Edited</option>
                </select>
            </div>

            <div id="notes-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            <div id="no-notes-message" class="hidden text-center py-12">
                <p class="text-gray-500 dark:text-gray-400">No notes found.</p>
            </div>
        </main>
    </div>

    <!-- Modals and Toasts -->
    <div id="read-note-modal" class="modal fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-60"
        role="dialog" aria-modal="true">
        <div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-11/12 max-w-2xl">
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 id="modal-title" class="text-2xl font-bold"></h2>
                    <button id="modal-close-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700"
                        aria-label="Close"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M6 18L18 6M6 6l12 12"></path>
                        </svg></button>
                </div>
                <p id="modal-date" class="text-sm text-gray-500 dark:text-gray-400 mb-6"></p>
                <div class="max-h-[60vh] overflow-y-auto pr-2">
                    <p id="modal-description" class="whitespace-pre-wrap"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="confirm-modal" class="modal fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-60"
        role="alertdialog" aria-modal="true">
        <div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-xl w-11/12 max-w-md p-6">
            <h3 class="text-lg font-medium mb-4">Confirm Deletion</h3>
            <p class="text-sm text-gray-600 dark:text-gray-300 mb-6">Are you sure you want to delete this note? This
                action cannot be undone.</p>
            <div class="flex justify-end gap-3">
                <button id="confirm-cancel-btn"
                    class="px-4 py-2 text-sm rounded-lg bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500">Cancel</button>
                <button id="confirm-delete-btn"
                    class="px-4 py-2 text-sm rounded-lg bg-red-600 text-white hover:bg-red-700">Delete</button>
            </div>
        </div>
    </div>

    <div id="toast-container" class="fixed top-5 right-5 z-50 space-y-3"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const noteForm = document.getElementById('note-form');
            const noteIdInput = document.getElementById('note-id');
            const noteTitleInput = document.getElementById('note-title');
            const noteDateInput = document.getElementById('note-date');
            const noteDescriptionInput = document.getElementById('note-description');
            const noteTagsInput = document.getElementById('note-tags');
            const notesContainer = document.getElementById('notes-container');
            const searchBar = document.getElementById('search-bar');
            const themeToggle = document.getElementById('theme-toggle');
            const lightIcon = document.getElementById('theme-toggle-light-icon');
            const darkIcon = document.getElementById('theme-toggle-dark-icon');
            const saveBtn = document.getElementById('save-btn');
            const cancelEditBtn = document.getElementById('cancel-edit-btn');
            const noNotesMessage = document.getElementById('no-notes-message');
            const sortBy = document.getElementById('sort-by');
            const tagFilterContainer = document.getElementById('tag-filter-container');
            const importBtn = document.getElementById('import-btn');
            const importFile = document.getElementById('import-file');
            const exportBtn = document.getElementById('export-btn');

            // Modal Elements
            const readNoteModal = document.getElementById('read-note-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalDate = document.getElementById('modal-date');
            const modalDescription = document.getElementById('modal-description');
            const modalCloseBtn = document.getElementById('modal-close-btn');

            // Confirm Modal Elements
            const confirmModal = document.getElementById('confirm-modal');
            const confirmCancelBtn = document.getElementById('confirm-cancel-btn');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

            let activeTag = null;
            let noteToDelete = null;

            // --- Core Utilities ---
            const getNotes = () => JSON.parse(localStorage.getItem('notes') || '[]');
            const saveNotes = (notes) => localStorage.setItem('notes', JSON.stringify(notes));

            // --- Toast Notifications ---
            const showToast = (message, type = 'success') => {
                const toastContainer = document.getElementById('toast-container');
                const toast = document.createElement('div');
                const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
                toast.className = `toast text-white px-4 py-2 rounded-lg shadow-lg ${bgColor}`;
                toast.textContent = message;
                toastContainer.appendChild(toast);
                setTimeout(() => {
                    toast.classList.add('toast-exit');
                    toast.addEventListener('animationend', () => toast.remove());
                }, 3000);
            };

            // --- Theme Management ---
            const updateThemeIcons = () => {
                const isDark = document.documentElement.classList.contains('dark');
                lightIcon.classList.toggle('hidden', isDark);
                darkIcon.classList.toggle('hidden', !isDark);
            };
            themeToggle.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
                updateThemeIcons();
            });

            // --- Modal Management ---
            const openModal = (modal) => {
                modal.classList.remove('hidden');
                modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')?.focus();
            };
            const closeModal = (modal) => modal.classList.add('hidden');

            modalCloseBtn.addEventListener('click', () => closeModal(readNoteModal));
            readNoteModal.addEventListener('click', (e) => e.target === readNoteModal && closeModal(readNoteModal));

            confirmCancelBtn.addEventListener('click', () => closeModal(confirmModal));
            confirmModal.addEventListener('click', (e) => e.target === confirmModal && closeModal(confirmModal));

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal(readNoteModal);
                    closeModal(confirmModal);
                }
            });

            // --- Note Rendering ---
            const renderNotes = () => {
                let notes = getNotes();
                const searchTerm = searchBar.value.toLowerCase();
                const sortValue = sortBy.value;

                // Filter
                if (searchTerm) notes = notes.filter(n => n.title.toLowerCase().includes(searchTerm) || n.description.toLowerCase().includes(searchTerm));
                if (activeTag) notes = notes.filter(n => n.tags.includes(activeTag));

                // Sort
                notes.sort((a, b) => {
                    const pinA = a.pinned ? -1 : 1;
                    const pinB = b.pinned ? -1 : 1;
                    if (a.pinned !== b.pinned) return pinA - pinB;

                    switch (sortValue) {
                        case 'date-asc': return new Date(a.date) - new Date(b.date);
                        case 'title-asc': return a.title.localeCompare(b.title);
                        case 'title-desc': return b.title.localeCompare(a.title);
                        case 'edited-desc': return (b.lastEdited || 0) - (a.lastEdited || 0);
                        default: return new Date(b.date) - new Date(a.date);
                    }
                });

                notesContainer.innerHTML = '';
                noNotesMessage.classList.toggle('hidden', notes.length > 0);

                notes.forEach(note => {
                    const noteEl = document.createElement('div');
                    noteEl.className = `note-card bg-white dark:bg-gray-800 rounded-xl shadow-lg flex flex-col justify-between transition-shadow duration-300 ${note.pinned ? 'ring-2 ring-yellow-400' : ''}`;
                    noteEl.dataset.id = note.id;

                    const tagsHTML = (note.tags || []).map(tag => `<span class="bg-blue-100 text-blue-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300">${tag}</span>`).join('');

                    noteEl.innerHTML = `
                    <div class="p-5 cursor-pointer flex-grow note-content-area">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-semibold">${note.title}</h3>
                            <button class="pin-btn p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700" aria-label="Pin note">
                                <svg class="w-5 h-5 ${note.pinned ? 'text-yellow-500' : 'text-gray-400'}" fill="currentColor" viewBox="0 0 20 20"><path d="M10.49 2.2a.75.75 0 00-1.48 0l-3.5 7.5-1.54.33a.75.75 0 00-.54 1.28l4.33 4.22-1.02 5.98a.75.75 0 001.09.79l5.34-2.8 5.34 2.8a.75.75 0 001.09-.79l-1.02-5.98 4.33-4.22a.75.75 0 00-.54-1.28l-1.54-.33-3.5-7.5z"/></svg>
                            </button>
                        </div>
                        <div class="mb-3">${tagsHTML}</div>
                        <p class="text-gray-600 dark:text-gray-300 whitespace-pre-wrap note-description-truncate">${note.description}</p>
                    </div>
                    <div class="flex justify-between items-center p-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50 rounded-b-xl">
                        <span class="text-xs text-gray-500">${new Date(note.date).toLocaleDateString()}</span>
                        <div class="space-x-2">
                            <button class="share-btn text-sm font-medium hover:text-blue-500">Share</button>
                            <button class="edit-btn text-sm font-medium hover:text-green-500">Edit</button>
                            <button class="delete-btn text-sm font-medium hover:text-red-500">Delete</button>
                        </div>
                    </div>
                `;
                    notesContainer.appendChild(noteEl);
                });
                renderTags();
            };

            const renderTags = () => {
                const notes = getNotes();
                const allTags = [...new Set(notes.flatMap(n => n.tags || []))];
                tagFilterContainer.innerHTML = '';
                allTags.forEach(tag => {
                    const tagBtn = document.createElement('button');
                    tagBtn.textContent = tag;
                    tagBtn.className = `px-3 py-1 text-sm rounded-full transition ${activeTag === tag ? 'bg-blue-500 text-white' : 'bg-gray-200 dark:bg-gray-700 hover:bg-gray-300'}`;
                    tagBtn.onclick = () => {
                        activeTag = activeTag === tag ? null : tag;
                        renderNotes();
                    };
                    tagFilterContainer.appendChild(tagBtn);
                });
            };

            // --- Form & Note Management ---
            const resetForm = () => {
                noteForm.reset();
                noteIdInput.value = '';
                saveBtn.textContent = 'Save Note';
                cancelEditBtn.classList.add('hidden');
                noteDateInput.value = new Date().toISOString().split('T')[0];
                localStorage.removeItem('noteDraft');
            };

            const saveDraft = () => {
                const draft = {
                    title: noteTitleInput.value,
                    date: noteDateInput.value,
                    tags: noteTagsInput.value,
                    description: noteDescriptionInput.value,
                };
                localStorage.setItem('noteDraft', JSON.stringify(draft));
            };

            const restoreDraft = () => {
                const draft = JSON.parse(localStorage.getItem('noteDraft') || '{}');
                if (draft.title) {
                    noteTitleInput.value = draft.title;
                    noteDateInput.value = draft.date;
                    noteTagsInput.value = draft.tags;
                    noteDescriptionInput.value = draft.description;
                }
            };

            noteForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const id = noteIdInput.value;
                const tags = noteTagsInput.value.split(',').map(t => t.trim()).filter(Boolean);
                let notes = getNotes();

                if (id) {
                    const index = notes.findIndex(n => n.id === id);
                    if (index > -1) {
                        notes[index] = { ...notes[index], title: noteTitleInput.value, date: noteDateInput.value, description: noteDescriptionInput.value, tags, lastEdited: Date.now() };
                        showToast('Note updated successfully!');
                    }
                } else {
                    notes.push({ id: crypto.randomUUID(), title: noteTitleInput.value, date: noteDateInput.value, description: noteDescriptionInput.value, tags, pinned: false, lastEdited: Date.now() });
                    showToast('Note saved successfully!');
                }
                saveNotes(notes);
                resetForm();
                renderNotes();
            });

            notesContainer.addEventListener('click', (e) => {
                const noteCard = e.target.closest('.note-card');
                if (!noteCard) return;
                const noteId = noteCard.dataset.id;
                const notes = getNotes();
                const note = notes.find(n => n.id === noteId);

                if (e.target.closest('.delete-btn')) {
                    noteToDelete = noteId;
                    openModal(confirmModal);
                } else if (e.target.closest('.edit-btn')) {
                    noteIdInput.value = note.id;
                    noteTitleInput.value = note.title;
                    noteDateInput.value = new Date(note.date).toISOString().split('T')[0];
                    noteDescriptionInput.value = note.description;
                    noteTagsInput.value = (note.tags || []).join(', ');
                    saveBtn.textContent = 'Update Note';
                    cancelEditBtn.classList.remove('hidden');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    noteTitleInput.focus();
                } else if (e.target.closest('.pin-btn')) {
                    const index = notes.findIndex(n => n.id === noteId);
                    notes[index].pinned = !notes[index].pinned;
                    saveNotes(notes);
                    renderNotes();
                } else if (e.target.closest('.share-btn')) {
                    const shareText = `Title: ${note.title}\nDate: ${new Date(note.date).toLocaleDateString()}\n\n${note.description}`;
                    navigator.clipboard.writeText(shareText).then(() => showToast('Note copied to clipboard!'));
                } else if (e.target.closest('.note-content-area')) {
                    modalTitle.textContent = note.title;
                    modalDate.textContent = new Date(note.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                    modalDescription.textContent = note.description;
                    openModal(readNoteModal);
                }
            });

            confirmDeleteBtn.addEventListener('click', () => {
                if (noteToDelete) {
                    let notes = getNotes().filter(n => n.id !== noteToDelete);
                    saveNotes(notes);
                    renderNotes();
                    closeModal(confirmModal);
                    showToast('Note deleted.', 'error');
                    noteToDelete = null;
                }
            });

            // --- Import / Export ---
            exportBtn.addEventListener('click', () => {
                const notes = getNotes();
                const blob = new Blob([JSON.stringify(notes, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `noteflow-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                showToast('Notes exported!');
            });

            importBtn.addEventListener('click', () => importFile.click());
            importFile.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const importedNotes = JSON.parse(event.target.result);
                        if (Array.isArray(importedNotes)) {
                            saveNotes(importedNotes);
                            renderNotes();
                            showToast('Notes imported successfully!');
                        } else {
                            showToast('Invalid file format.', 'error');
                        }
                    } catch (err) {
                        showToast('Could not parse file.', 'error');
                    }
                };
                reader.readAsText(file);
                importFile.value = ''; // Reset for next import
            });

            // --- Event Listeners ---
            cancelEditBtn.addEventListener('click', resetForm);
            searchBar.addEventListener('input', renderNotes);
            sortBy.addEventListener('change', renderNotes);
            noteForm.addEventListener('input', saveDraft);

            // --- Initial Load ---
            const initialize = () => {
                updateThemeIcons();
                resetForm();
                restoreDraft();
                renderNotes();
            };

            initialize();
        });
    </script>
</body>

</html>